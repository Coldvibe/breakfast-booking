<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin ‚Äî Offre de demain</title>
  <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
<div class="container">

  <div class="header">
    <div class="brand">
      <div class="logo egg-logo">
        <svg viewBox="0 0 64 64" width="28" height="28">
          <path d="M32 6 C20 6 10 18 10 30 c0 12 10 22 22 22 s22-10 22-22 C54 18 44 6 32 6Z"
                fill="#fff" opacity="0.95"/>
          <circle cx="32" cy="32" r="8" fill="#facc15"/>
        </svg>
      </div>
      <div>
        <h1>Offre de demain</h1>
        <p>Zakaria choisit les plats & accompagnements + max/personne</p>
      </div>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <div class="badge">Date : <b>{{ offer_date }}</b></div>
      <a class="btn secondary" href="/admin" style="text-decoration:none">Dashboard</a>
      <a class="btn secondary" href="/" style="text-decoration:none">Accueil</a>
    </div>
  </div>

  <div class="grid">

    <div class="card">
      <h2 class="card-title">üç≥ Ajouter un plat (MAIN)</h2>
      <form class="form" method="post" action="/admin/offers/add-main">
        <div>
          <label>Plat</label>
          <select name="recipe_id" style="width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:var(--panel-2);color:var(--text)">
            {% for r in recipes %}
              <option value="{{ r['id'] }}">{{ r['name'] }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Max par personne</label>
          <input type="number" min="1" name="max_per_person" value="1">
        </div>
        <button class="btn" type="submit">Ajouter</button>
      </form>

      <hr class="hr">

      <h3 class="card-title">Plats propos√©s</h3>
      {% if mains|length == 0 %}
        <div class="muted">Aucun plat propos√©.</div>
      {% else %}
        <div class="list">
          {% for o in mains %}
            <div class="item" style="display:flex;justify-content:space-between;gap:10px;align-items:center">
              <div>
                <div class="name">{{ o["label"] }}</div>
                <div class="meta">
                  <span class="muted">Max/pers :</span> {{ o["max_per_person"] }}
                  {% if not o["is_active"] %} ‚Ä¢ <span style="color:#ffd2d2">Inactif</span>{% endif %}
                </div>
              </div>

              <div style="display:flex;gap:8px;align-items:center">
                <form method="post" action="/admin/offers/update-max" style="display:flex;gap:6px;align-items:center">
                  <input type="hidden" name="offer_id" value="{{ o['id'] }}">
                  <input type="number" min="1" name="max_per_person" value="{{ o['max_per_person'] }}" style="width:90px">
                  <button class="btn secondary" type="submit">OK</button>
                </form>

                <form method="post" action="/admin/offers/toggle">
                  <input type="hidden" name="offer_id" value="{{ o['id'] }}">
                  <input type="hidden" name="is_active" value="{{ 0 if o['is_active'] else 1 }}">
                  {% if o["is_active"] %}
                    <button class="btn danger" type="submit">D√©sactiver</button>
                  {% else %}
                    <button class="btn secondary" type="submit">R√©activer</button>
                  {% endif %}
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="card">
      <h2 class="card-title">ü•ñ Ajouter un accompagnement (SIDE)</h2>
      <form class="form" method="post" action="/admin/offers/add-side">
        <div>
          <label>Accompagnement</label>
          <select name="food_id" style="width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:var(--panel-2);color:var(--text)">
            {% for f in foods %}
              <option value="{{ f['id'] }}">{{ f['name'] }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Max par personne</label>
          <input type="number" min="1" name="max_per_person" value="1">
        </div>
        <button class="btn" type="submit">Ajouter</button>
      </form>

      <hr class="hr">

      <h3 class="card-title">Accompagnements propos√©s</h3>
      {% if sides|length == 0 %}
        <div class="muted">Aucun accompagnement propos√©.</div>
      {% else %}
        <div class="list">
          {% for o in sides %}
            <div class="item" style="display:flex;justify-content:space-between;gap:10px;align-items:center">
              <div>
                <div class="name">{{ o["label"] }}</div>
                <div class="meta">
                  <span class="muted">Max/pers :</span> {{ o["max_per_person"] }}
                  {% if not o["is_active"] %} ‚Ä¢ <span style="color:#ffd2d2">Inactif</span>{% endif %}
                </div>
              </div>

              <div style="display:flex;gap:8px;align-items:center">
                <form method="post" action="/admin/offers/update-max" style="display:flex;gap:6px;align-items:center">
                  <input type="hidden" name="offer_id" value="{{ o['id'] }}">
                  <input type="number" min="1" name="max_per_person" value="{{ o['max_per_person'] }}" style="width:90px">
                  <button class="btn secondary" type="submit">OK</button>
                </form>

                <form method="post" action="/admin/offers/toggle">
                  <input type="hidden" name="offer_id" value="{{ o['id'] }}">
                  <input type="hidden" name="is_active" value="{{ 0 if o['is_active'] else 1 }}">
                  {% if o["is_active"] %}
                    <button class="btn danger" type="submit">D√©sactiver</button>
                  {% else %}
                    <button class="btn secondary" type="submit">R√©activer</button>
                  {% endif %}
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

  </div>

</div>
</body>
</html>
